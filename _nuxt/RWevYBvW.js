import{F as M}from"./BGy2h51d.js";import{E as N,a as A}from"./zU8J6lWz.js";import{q as G,a9 as z,aa as P,E as L,ab as O,_ as j,w as H,F as J}from"./Do5WvczJ.js";import{Q as q,ax as K,R as Q,e as y,p as R,m as h,o as i,w as r,i as W,a as t,n as v,j as s,x as S,z as I,as as X,c as V,d as f,t as b,F as Y,b as m,P as Z,T as ee,_ as se,aI as te,f as oe,N as B,aJ as ae,aK as le,l as ne}from"./n9gZW00_.js";import"./CMHRio4E.js";const ie=["light","dark"],re=G({title:{type:String,default:""},description:{type:String,default:""},type:{type:String,values:z(P),default:"info"},closable:{type:Boolean,default:!0},closeText:{type:String,default:""},showIcon:Boolean,center:Boolean,effect:{type:String,values:ie,default:"light"}}),ue={close:E=>E instanceof MouseEvent},ce=q({name:"ElAlert"}),de=q({...ce,props:re,emits:ue,setup(E,{emit:T}){const c=E,{Close:u}=O,g=K(),o=Q("alert"),w=y(!0),k=R(()=>P[c.type]),C=R(()=>!!(c.description||g.default)),n=a=>{w.value=!1,T("close",a)};return(a,x)=>(i(),h(ee,{name:s(o).b("fade"),persisted:""},{default:r(()=>[W(t("div",{class:v([s(o).b(),s(o).m(a.type),s(o).is("center",a.center),s(o).is(a.effect)]),role:"alert"},[a.showIcon&&(a.$slots.icon||s(k))?(i(),h(s(L),{key:0,class:v([s(o).e("icon"),{[s(o).is("big")]:s(C)}])},{default:r(()=>[I(a.$slots,"icon",{},()=>[(i(),h(X(s(k))))])]),_:3},8,["class"])):S("v-if",!0),t("div",{class:v(s(o).e("content"))},[a.title||a.$slots.title?(i(),V("span",{key:0,class:v([s(o).e("title"),{"with-description":s(C)}])},[I(a.$slots,"title",{},()=>[f(b(a.title),1)])],2)):S("v-if",!0),s(C)?(i(),V("p",{key:1,class:v(s(o).e("description"))},[I(a.$slots,"default",{},()=>[f(b(a.description),1)])],2)):S("v-if",!0),a.closable?(i(),V(Y,{key:2},[a.closeText?(i(),V("div",{key:0,class:v([s(o).e("close-btn"),s(o).is("customed")]),onClick:n},b(a.closeText),3)):(i(),h(s(L),{key:1,class:v(s(o).e("close-btn")),onClick:n},{default:r(()=>[m(s(u))]),_:1},8,["class"]))],64)):S("v-if",!0)],2)],2),[[Z,w.value]])]),_:3},8,["name"]))}});var pe=j(de,[["__file","alert.vue"]]);const me=H(pe),fe=window.setInterval,ve={class:"signin-container"},ge={class:"signin-card"},we={class:"space-y-4"},ye={class:"flex gap-2 w-full"},he={class:"code-btn flex items-center justify-between"},_e={class:"flex items-center"},be={__name:"login",setup(E){const T=y(),c=y(!1),u=y(""),g=y(!1),o=y(0),w=te(),k=le(),C={email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,message:"密码长度至少8位",trigger:"blur"}]},n=y({email:"",password:"",code:""});oe(()=>{B().query.code&&a()});async function a(){var e;const d=B();if(!d.query.code){const l=ae();window.location.href="https://accounts.google.com/o/oauth2/v2/auth?"+new URLSearchParams({client_id:l.public.googleClientId,redirect_uri:l.public.googleRedirectUri,response_type:"code",scope:"openid profile email",access_type:"offline"});return}try{c.value=!0;const l=await $fetch("/api/auth/google",{query:{code:d.query.code}});console.log("Google Login Response:",l),l.statusCode===200&&(w.setUser(l.body.user),w.setToken(l.body.token),k.push("/auth/profile"))}catch(l){l.value=((e=l.data)==null?void 0:e.message)||"Google登录失败"}finally{c.value=!1}}async function x(){var e;if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(n.value.email)){u.value="请输入有效的邮箱地址";return}o.value=60;const d=fe(()=>{o.value--,o.value<=0&&clearInterval(d)},1e3);try{await $fetch("/api/auth/code",{method:"POST",body:{email:n.value.email.toLowerCase()}})}catch(l){u.value=((e=l.data)==null?void 0:e.message)||"验证码发送失败"}}async function U(){var d;try{if(!await T.value.validate())return;c.value=!0,u.value="";const l={email:n.value.email.toLowerCase(),...g.value?{code:n.value.code}:{password:n.value.password}},p=await $fetch("/api/auth/login",{method:"POST",body:l});console.log("Login Response:",p.statusCode),p.statusCode?(w.setUser(p.body.user),w.setToken(p.body.token),k.push("/auth/profile")):u.value=p.message||"登录失败"}catch(e){u.value=((d=e.data)==null?void 0:d.message)||"登录失败"}finally{c.value=!1}}return(d,e)=>{const l=M,p=A,$=J,D=N,F=me;return i(),V("div",ve,[t("div",ge,[e[6]||(e[6]=t("h2",{class:"signin-title"},"Let's get started!",-1)),t("button",{class:"google-btn",onClick:a},e[4]||(e[4]=[t("img",{src:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg",alt:"Google Logo",class:"google-logo"},null,-1),f(" Continue with Google ")])),e[7]||(e[7]=t("div",{class:"divider-row"},[t("div",{class:"divider"}),t("span",{class:"divider-text"},"OR"),t("div",{class:"divider"})],-1)),m(D,{ref_key:"formRef",ref:T,model:n.value,rules:C,class:"login-form",onSubmit:ne(U,["prevent"])},{default:r(()=>[t("div",we,[m(p,{prop:"email"},{default:r(()=>[m(l,{"suffix-icon":"Message",modelValue:n.value.email,"onUpdate:modelValue":e[0]||(e[0]=_=>n.value.email=_),type:"email",placeholder:"邮箱地址",class:v(["[&>.el-input__wrapper]:shadow-none [&>.el-input__wrapper]:px-3 [&>.el-input__wrapper]:h-auto",{"is-error":u.value}])},null,8,["modelValue","class"])]),_:1}),g.value?(i(),h(p,{key:1,prop:"code"},{default:r(()=>[t("div",ye,[m(l,{modelValue:n.value.code,"onUpdate:modelValue":e[2]||(e[2]=_=>n.value.code=_),placeholder:"验证码",class:"flex-1"},null,8,["modelValue"]),m($,{type:"primary",disabled:o.value>0,onClick:x},{default:r(()=>[f(b(o.value>0?`${o.value}秒后重发`:"获取验证码"),1)]),_:1},8,["disabled"])])]),_:1})):(i(),h(p,{key:0,prop:"password"},{default:r(()=>[m(l,{"suffix-icon":"Lock",modelValue:n.value.password,"onUpdate:modelValue":e[1]||(e[1]=_=>n.value.password=_),type:"password",placeholder:"密码","show-password":"",class:"[&>.el-input__wrapper]:shadow-none [&>.el-input__wrapper]:px-3 [&>.el-input__wrapper]:h-auto"},null,8,["modelValue"])]),_:1}))]),t("div",he,[t("div",_e,[m($,{type:"primary",link:"",onClick:e[3]||(e[3]=_=>g.value=!g.value)},{default:r(()=>[f(b(g.value?"密码登录":"验证码登录"),1)]),_:1})])]),t("div",null,[m($,{"native-type":"submit",loading:c.value,type:"primary",class:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium"},{loading:r(()=>e[5]||(e[5]=[t("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])),default:r(()=>[f(" "+b(c.value?"登录中...":"邮箱登录/注册"),1)]),_:1},8,["loading"])])]),_:1},8,["model"]),u.value?(i(),h(F,{key:0,title:u.value,type:"error","show-icon":"",class:"mt-4",closable:!0},null,8,["title"])):S("",!0),e[8]||(e[8]=t("p",{class:"agreement"},[f(" By creating an account you agree with our "),t("a",{href:"#",class:"link"},"Terms & Conditions"),f(" and "),t("a",{href:"#",class:"link"},"Privacy Policy"),f(". ")],-1))])])}}},Te=se(be,[["__scopeId","data-v-78fd7300"]]);export{Te as default};
