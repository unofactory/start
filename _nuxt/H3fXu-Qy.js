var L=Object.defineProperty;var U=n=>{throw TypeError(n)};var K=(n,a,s)=>a in n?L(n,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[a]=s;var j=(n,a,s)=>K(n,typeof a!="symbol"?a+"":a,s),H=(n,a,s)=>a.has(n)||U("Cannot "+s);var A=(n,a,s)=>(H(n,a,"read from private field"),s?s.call(n):a.get(n)),I=(n,a,s)=>a.has(n)?U("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(n):a.set(n,s);import{_ as G,a as J}from"./Bl0YBswq.js";import{A as Q,B as k,e as $,C as Z,D as W,E as X,G as Y,q as ee,H as N,I as q,J as te,K as se,j as ae,p as re,r as V,L as ne,M as z,N as oe,O as ie,f as le,c as B,a as g,b as ce,i as ue,v as de,s as fe,x as S,d as F,t as R,F as he,h as ye,o as D,m as ge}from"./n9gZW00_.js";function pe(n){return typeof n=="string"?`'${n}'`:new me().serialize(n)}const me=function(){var a;class n{constructor(){I(this,a,new Map)}compare(e,t){const r=typeof e,i=typeof t;return r==="string"&&i==="string"?e.localeCompare(t):r==="number"&&i==="number"?e-t:String.prototype.localeCompare.call(this.serialize(e,!0),this.serialize(t,!0))}serialize(e,t){if(e===null)return"null";switch(typeof e){case"string":return t?e:`'${e}'`;case"bigint":return`${e}n`;case"object":return this.$object(e);case"function":return this.$function(e)}return String(e)}serializeObject(e){const t=Object.prototype.toString.call(e);if(t!=="[object Object]")return this.serializeBuiltInType(t.length<10?`unknown:${t}`:t.slice(8,-1),e);const r=e.constructor,i=r===Object||r===void 0?"":r.name;if(i!==""&&globalThis[i]===r)return this.serializeBuiltInType(i,e);if(typeof e.toJSON=="function"){const u=e.toJSON();return i+(u!==null&&typeof u=="object"?this.$object(u):`(${this.serialize(u)})`)}return this.serializeObjectEntries(i,Object.entries(e))}serializeBuiltInType(e,t){const r=this["$"+e];if(r)return r.call(this,t);if(typeof(t==null?void 0:t.entries)=="function")return this.serializeObjectEntries(e,t.entries());throw new Error(`Cannot serialize ${e}`)}serializeObjectEntries(e,t){const r=Array.from(t).sort((u,f)=>this.compare(u[0],f[0]));let i=`${e}{`;for(let u=0;u<r.length;u++){const[f,p]=r[u];i+=`${this.serialize(f,!0)}:${this.serialize(p)}`,u<r.length-1&&(i+=",")}return i+"}"}$object(e){let t=A(this,a).get(e);return t===void 0&&(A(this,a).set(e,`#${A(this,a).size}`),t=this.serializeObject(e),A(this,a).set(e,t)),t}$function(e){const t=Function.prototype.toString.call(e);return t.slice(-15)==="[native code] }"?`${e.name||""}()[native]`:`${e.name}(${e.length})${t.replace(/\s*\n\s*/g,"")}`}$Array(e){let t="[";for(let r=0;r<e.length;r++)t+=this.serialize(e[r]),r<e.length-1&&(t+=",");return t+"]"}$Date(e){try{return`Date(${e.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(e){return`ArrayBuffer[${new Uint8Array(e).join(",")}]`}$Set(e){return`Set${this.$Array(Array.from(e).sort((t,r)=>this.compare(t,r)))}`}$Map(e){return this.serializeObjectEntries("Map",e.entries())}}a=new WeakMap;for(const s of["Error","RegExp","URL"])n.prototype["$"+s]=function(e){return`${s}(${e})`};for(const s of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])n.prototype["$"+s]=function(e){return`${s}[${e.join(",")}]`};for(const s of["BigInt64Array","BigUint64Array"])n.prototype["$"+s]=function(e){return`${s}[${e.join("n,")}${e.length>0?"n":""}]`};return n}(),ve=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],_e=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],we="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",O=[];class be{constructor(){j(this,"_data",new M);j(this,"_hash",new M([...ve]));j(this,"_nDataBytes",0);j(this,"_minBufferSize",0)}finalize(a){a&&this._append(a);const s=this._nDataBytes*8,e=this._data.sigBytes*8;return this._data.words[e>>>5]|=128<<24-e%32,this._data.words[(e+64>>>9<<4)+14]=Math.floor(s/4294967296),this._data.words[(e+64>>>9<<4)+15]=s,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(a,s){const e=this._hash.words;let t=e[0],r=e[1],i=e[2],u=e[3],f=e[4],p=e[5],_=e[6],c=e[7];for(let y=0;y<64;y++){if(y<16)O[y]=a[s+y]|0;else{const o=O[y-15],m=(o<<25|o>>>7)^(o<<14|o>>>18)^o>>>3,h=O[y-2],b=(h<<15|h>>>17)^(h<<13|h>>>19)^h>>>10;O[y]=m+O[y-7]+b+O[y-16]}const w=f&p^~f&_,x=t&r^t&i^r&i,C=(t<<30|t>>>2)^(t<<19|t>>>13)^(t<<10|t>>>22),d=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),v=c+d+w+_e[y]+O[y],l=C+x;c=_,_=p,p=f,f=u+v|0,u=i,i=r,r=t,t=v+l|0}e[0]=e[0]+t|0,e[1]=e[1]+r|0,e[2]=e[2]+i|0,e[3]=e[3]+u|0,e[4]=e[4]+f|0,e[5]=e[5]+p|0,e[6]=e[6]+_|0,e[7]=e[7]+c|0}_append(a){typeof a=="string"&&(a=M.fromUtf8(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes}_process(a){let s,e=this._data.sigBytes/64;a?e=Math.ceil(e):e=Math.max((e|0)-this._minBufferSize,0);const t=e*16,r=Math.min(t*4,this._data.sigBytes);if(t){for(let i=0;i<t;i+=16)this._doProcessBlock(this._data.words,i);s=this._data.words.splice(0,t),this._data.sigBytes-=r}return new M(s,r)}}class M{constructor(a,s){j(this,"words");j(this,"sigBytes");a=this.words=a||[],this.sigBytes=s===void 0?a.length*4:s}static fromUtf8(a){const s=unescape(encodeURIComponent(a)),e=s.length,t=[];for(let r=0;r<e;r++)t[r>>>2]|=(s.charCodeAt(r)&255)<<24-r%4*8;return new M(t,e)}toBase64(){const a=[];for(let s=0;s<this.sigBytes;s+=3){const e=this.words[s>>>2]>>>24-s%4*8&255,t=this.words[s+1>>>2]>>>24-(s+1)%4*8&255,r=this.words[s+2>>>2]>>>24-(s+2)%4*8&255,i=e<<16|t<<8|r;for(let u=0;u<4&&s*8+u*6<this.sigBytes*8;u++)a.push(we.charAt(i>>>6*(3-u)&63))}return a.join("")}concat(a){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let s=0;s<a.sigBytes;s++){const e=a.words[s>>>2]>>>24-s%4*8&255;this.words[this.sigBytes+s>>>2]|=e<<24-(this.sigBytes+s)%4*8}else for(let s=0;s<a.sigBytes;s+=4)this.words[this.sigBytes+s>>>2]=a.words[s>>>2];this.sigBytes+=a.sigBytes}}function De(n){return new be().finalize(n).toBase64()}function Be(n){return De(pe(n))}const $e=n=>n==="defer"||n===!1;function xe(...n){var C;const a=typeof n[n.length-1]=="string"?n.pop():void 0;typeof n[0]!="string"&&n.unshift(a);let[s,e,t={}]=n;if(typeof s!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof e!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const r=Q(),i=e,u=()=>k.value,f=()=>r.isHydrating?r.payload.data[s]:r.static.data[s];t.server??(t.server=!0),t.default??(t.default=u),t.getCachedData??(t.getCachedData=f),t.lazy??(t.lazy=!1),t.immediate??(t.immediate=!0),t.deep??(t.deep=k.deep),t.dedupe??(t.dedupe="cancel");const p=t.getCachedData(s,r),_=p!=null;if(!r._asyncData[s]||!t.immediate){(C=r.payload._errors)[s]??(C[s]=k.errorValue);const d=t.deep?$:Z;r._asyncData[s]={data:d(_?p:t.default()),pending:$(!_),error:W(r.payload._errors,s),status:$("idle"),_default:t.default}}const c={...r._asyncData[s]};delete c._default,c.refresh=c.execute=(d={})=>{if(r._asyncDataPromises[s]){if($e(d.dedupe??t.dedupe))return r._asyncDataPromises[s];r._asyncDataPromises[s].cancelled=!0}if(d._initial||r.isHydrating&&d._initial!==!1){const l=d._initial?p:t.getCachedData(s,r);if(l!=null)return Promise.resolve(l)}c.pending.value=!0,c.status.value="pending";const v=new Promise((l,o)=>{try{l(i(r))}catch(m){o(m)}}).then(async l=>{if(v.cancelled)return r._asyncDataPromises[s];let o=l;t.transform&&(o=await t.transform(l)),t.pick&&(o=je(o,t.pick)),r.payload.data[s]=o,c.data.value=o,c.error.value=k.errorValue,c.status.value="success"}).catch(l=>{if(v.cancelled)return r._asyncDataPromises[s];c.error.value=se(l),c.data.value=ae(t.default()),c.status.value="error"}).finally(()=>{v.cancelled||(c.pending.value=!1,delete r._asyncDataPromises[s])});return r._asyncDataPromises[s]=v,r._asyncDataPromises[s]},c.clear=()=>Ce(r,s);const y=()=>c.refresh({_initial:!0}),w=t.server!==!1&&r.payload.serverRendered;{const d=X();if(d&&w&&t.immediate&&!d.sp&&(d.sp=[]),d&&!d._nuxtOnBeforeMountCbs){d._nuxtOnBeforeMountCbs=[];const o=d._nuxtOnBeforeMountCbs;Y(()=>{o.forEach(m=>{m()}),o.splice(0,o.length)}),ee(()=>o.splice(0,o.length))}w&&r.isHydrating&&(c.error.value||p!=null)?(c.pending.value=!1,c.status.value=c.error.value?"error":"success"):d&&(r.payload.serverRendered&&r.isHydrating||t.lazy)&&t.immediate?d._nuxtOnBeforeMountCbs.push(y):t.immediate&&y();const v=te();if(t.watch){const o=N(t.watch,()=>c.refresh());v&&q(o)}const l=r.hook("app:data:refresh",async o=>{(!o||o.includes(s))&&await c.refresh()});v&&q(l)}const x=Promise.resolve(r._asyncDataPromises[s]).then(()=>c);return Object.assign(x,c),x}function Ce(n,a){a in n.payload.data&&(n.payload.data[a]=void 0),a in n.payload._errors&&(n.payload._errors[a]=k.errorValue),n._asyncData[a]&&(n._asyncData[a].data.value=void 0,n._asyncData[a].error.value=k.errorValue,n._asyncData[a].pending.value=!1,n._asyncData[a].status.value="idle"),a in n._asyncDataPromises&&(n._asyncDataPromises[a]&&(n._asyncDataPromises[a].cancelled=!0),n._asyncDataPromises[a]=void 0)}function je(n,a){const s={};for(const e of a)s[e]=n[e];return s}function Oe(n,a,s){const[e={},t]=typeof a=="string"?[{},a]:[a,s],r=re(()=>z(n)),i=e.key||Be([t,typeof r.value=="string"?r.value:"",...ze(e)]);if(!i||typeof i!="string")throw new TypeError("[nuxt] [useFetch] key must be a string: "+i);const u=i===t?"$f"+i:i;if(!e.baseURL&&typeof r.value=="string"&&r.value[0]==="/"&&r.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:f,lazy:p,default:_,transform:c,pick:y,watch:w,immediate:x,getCachedData:C,deep:d,dedupe:v,...l}=e,o=V({...ne,...l,cache:typeof e.cache=="boolean"?void 0:e.cache}),m={server:f,lazy:p,default:_,transform:c,pick:y,immediate:x,getCachedData:C,deep:d,dedupe:v,watch:w===!1?[]:[o,r,...w||[]]};let h;return xe(u,()=>{var T;(T=h==null?void 0:h.abort)==null||T.call(h,new DOMException("Request aborted as another request to the same endpoint was initiated.","AbortError")),h=typeof AbortController<"u"?new AbortController:{};const E=z(e.timeout);let P;return E&&(P=setTimeout(()=>h.abort(new DOMException("Request aborted due to timeout.","AbortError")),E),h.signal.onabort=()=>clearTimeout(P)),(e.$fetch||globalThis.$fetch)(r.value,{signal:h.signal,...o}).finally(()=>{clearTimeout(P)})},m)}function ze(n){var s;const a=[((s=z(n.method))==null?void 0:s.toUpperCase())||"GET",z(n.baseURL)];for(const e of[n.params||n.query]){const t=z(e);if(!t)continue;const r={};for(const[i,u]of Object.entries(t))r[z(i)]=z(u);a.push(r)}return a}const ke={class:"search-page bg-gray-50 min-h-screen"},Me={class:"bg-white shadow-sm py-8"},Ae={class:"container mx-auto px-4"},Se={class:"max-w-2xl mx-auto relative mb-8"},Ee={class:"py-8"},Pe={class:"container mx-auto px-4"},Re={key:0,class:"mb-6 text-gray-600"},Te={class:"font-semibold"},Ue={key:0},Ie={key:1},qe={key:1,class:"flex justify-center items-center py-20"},Fe={key:2,class:"text-center py-20"},Ne={key:3,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6"},Ve={key:4,class:"flex justify-center mt-10"},Je={__name:"search",setup(n){const a=$(""),s=$("全部"),e=$("-createdAt"),t=$([]),r=$(!1),i=V({page:1,limit:20,total:0,pages:0,hasMore:!1}),u=$(["全部","排行榜","最新","AI","信息","社交媒体","影视","云盘","应用","工具","灵感","插画"]),f=oe(),p=ie();le(()=>{const{q:l,category:o,sort:m}=f.query;l&&(a.value=l),o&&(s.value=o),m&&(e.value=m),c()}),N([a,s,e],()=>{_()});const _=()=>{const l={};a.value&&(l.q=a.value),s.value!=="全部"&&(l.category=s.value),e.value!=="-createdAt"&&(l.sort=e.value),p.push({query:l})},c=async()=>{r.value=!0,i.page=1,t.value=[];try{await w()}catch(l){console.error("搜索出错:",l)}finally{r.value=!1}},y=async()=>{if(!(r.value||!i.hasMore)){r.value=!0,i.page++;try{await w(!0)}catch(l){console.error("加载更多出错:",l),i.page--}finally{r.value=!1}}},w=async(l=!1)=>{const o={keyword:a.value,category:s.value!=="全部"?s.value:"",page:i.page,limit:i.limit,sort:e.value},{data:m}=await Oe("/api/search",{method:"GET",params:o},"$rNwwtZtOjy");if(m.value&&m.value.success){const{resources:h,pagination:b}=m.value.data;l?t.value=[...t.value,...h]:t.value=h,Object.assign(i,b)}},x=l=>{s.value=l,c()},C=l=>{l==="降序"?e.value="-createdAt":l==="升序"&&(e.value="createdAt"),c()},d=()=>{a.value="",s.value="全部",e.value="-createdAt",c()},v=l=>{p.push(`/category/${l}`)};return(l,o)=>{const m=G,h=J;return D(),B("div",ke,[g("div",Me,[g("div",Ae,[o[2]||(o[2]=g("h1",{class:"text-3xl font-bold mb-6 text-center"},"资源搜索",-1)),g("div",Se,[ue(g("input",{"onUpdate:modelValue":o[0]||(o[0]=b=>a.value=b),type:"text",placeholder:"搜索资源名称、描述或标签...",class:"w-full px-6 py-4 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent pr-12",onKeyup:fe(c,["enter"])},null,544),[[de,a.value]]),g("button",{class:"absolute right-3 top-4 text-gray-500 hover:text-gray-700",onClick:c},o[1]||(o[1]=[g("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[g("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)]))])])]),ce(m,{categories:u.value,onCategoryChange:x,onSortChange:C},null,8,["categories"]),g("section",Ee,[g("div",Pe,[!r.value&&t.value.length>0?(D(),B("div",Re,[o[3]||(o[3]=F(" 找到 ")),g("span",Te,R(i.total),1),o[4]||(o[4]=F(" 个结果 ")),a.value?(D(),B("span",Ue,'，关键词："'+R(a.value)+'"',1)):S("",!0),s.value!=="全部"?(D(),B("span",Ie,'，分类："'+R(s.value)+'"',1)):S("",!0)])):S("",!0),r.value?(D(),B("div",qe,o[5]||(o[5]=[g("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"},null,-1)]))):t.value.length===0?(D(),B("div",Fe,[o[6]||(o[6]=g("svg",{class:"w-20 h-20 mx-auto text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[g("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),o[7]||(o[7]=g("h3",{class:"text-xl font-semibold text-gray-700 mb-2"},"未找到相关资源",-1)),o[8]||(o[8]=g("p",{class:"text-gray-500 mb-6"},"尝试使用不同的关键词或浏览其他分类",-1)),g("button",{class:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",onClick:d}," 重置搜索 ")])):(D(),B("div",Ne,[(D(!0),B(he,null,ye(t.value,b=>(D(),ge(h,{key:b._id,resource:b,showButton:!0,onClick:E=>v(b._id)},null,8,["resource","onClick"]))),128))])),!r.value&&i.hasMore?(D(),B("div",Ve,[g("button",{class:"bg-white border border-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:y}," 加载更多 ")])):S("",!0)])])])}}};export{Je as default};
